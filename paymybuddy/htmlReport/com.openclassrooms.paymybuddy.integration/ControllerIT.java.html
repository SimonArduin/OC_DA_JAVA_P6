<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ControllerIT.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in paymybuddy Coverage Results</a> &gt; <a href="index.source.html" class="el_package">com.openclassrooms.paymybuddy.integration</a> &gt; <span class="el_source">ControllerIT.java</span></div><h1>ControllerIT.java</h1><pre class="source lang-java linenums">package com.openclassrooms.paymybuddy.integration;

import com.openclassrooms.paymybuddy.TestVariables;
import jakarta.inject.Inject;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.MediaType;
import org.springframework.security.test.context.support.WithMockUser;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.transaction.annotation.Transactional;

import static org.springframework.security.test.web.servlet.request.SecurityMockMvcRequestPostProcessors.csrf;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;

@SpringBootTest
@AutoConfigureMockMvc
@Transactional
<span class="fc" id="L23">public class ControllerIT extends TestVariables {;</span>

    @Inject
    private MockMvc mockMvc;

    @BeforeEach
    public void setUp() {
<span class="fc" id="L30">        initializeVariables();</span>
<span class="fc" id="L31">    }</span>

    @Test
    void contextLoads() {
<span class="fc" id="L35">    }</span>
    @Nested
<span class="fc" id="L37">    class viewHomePageTests {</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void viewHomePageTest() throws Exception {
<span class="fc" id="L42">            mockMvc.perform(get(&quot;/&quot;).with(csrf()))</span>
<span class="fc" id="L43">                    .andExpect(status().is2xxSuccessful());</span>
<span class="fc" id="L44">        }</span>
        @Test
        public void viewHomePageTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L47">            mockMvc.perform(get(&quot;/&quot;).with(csrf()))</span>
<span class="fc" id="L48">                    .andExpect(status().is2xxSuccessful());</span>
<span class="fc" id="L49">        }</span>
    }


    @Nested
<span class="fc" id="L54">    class showRegistrationFormTests {</span>

<span class="fc" id="L56">        String getMapping = &quot;/register&quot;;</span>
<span class="fc" id="L57">        String viewName = &quot;signup_form&quot;;</span>

        @WithMockUser
        @Test
        public void showRegistrationFormTest() throws Exception {
<span class="fc" id="L62">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L63">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L64">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L65">        }</span>
        @Test
        public void showRegistrationFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L68">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L69">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L70">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L71">        }</span>
    }

    @Nested
<span class="fc" id="L75">    class processRegisterTests {</span>

<span class="fc" id="L77">        String getMapping = &quot;/process_register&quot;;</span>
<span class="fc" id="L78">        String viewName = &quot;register_success&quot;;</span>
/*
        String form = &quot;username=&quot;+userDto.getUsername()
                +&quot;&amp;email=&quot;+userDto.getEmail()
                +&quot;&amp;password=&quot;+userDto.getPassword()
                +&quot;&amp;iban=&quot;+userDto.getIban();
*/

<span class="fc" id="L86">        String form = &quot;username=username&amp;email=email&amp;password=password&amp;iban=iban&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processRegisterTest() throws Exception {
<span class="fc" id="L91">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L92">                            .content(form))</span>
<span class="fc" id="L93">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L94">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L95">        }</span>

        @Test
        public void processRegisterTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L99">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L100">                            .content(form))</span>
<span class="fc" id="L101">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L102">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L103">        }</span>

        @Test
        public void processRegisterTestIfEmpty() throws Exception {
<span class="pc" id="L107">            mockMvc.perform(post(getMapping)</span>
<span class="fc" id="L108">                            .with(csrf())</span>
<span class="fc" id="L109">                            .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L110">                            .content(&quot;username=&amp;email=&amp;password=&amp;iban=&quot;))</span>
<span class="nc" id="L111">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L112">        }</span>
        @Test
        public void processRegisterTestIfNull() throws Exception {
<span class="nc" id="L115">            mockMvc.perform(post(getMapping).with(csrf()))</span>
<span class="nc" id="L116">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L117">        }</span>
    }

    @Nested
<span class="fc" id="L121">    class profileTests {</span>

<span class="fc" id="L123">        String getMapping = &quot;/profile&quot;;</span>
<span class="fc" id="L124">        String viewName = &quot;profile&quot;;</span>
        
        @WithMockUser(&quot;user01&quot;)
        @Test
        public void profileTest() throws Exception {
<span class="fc" id="L129">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L130">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L131">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L132">        }</span>

        @Test
        public void profileTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L136">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L137">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L138">        }</span>

    }

    @Nested
<span class="fc" id="L143">    class contactTests {</span>

<span class="fc" id="L145">        String getMapping = &quot;/contact&quot;;</span>
<span class="fc" id="L146">        String viewName = &quot;contact&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void contactTest() throws Exception {
<span class="fc" id="L151">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L152">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L153">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L154">        }</span>

        @Test
        public void contactTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L158">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L159">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L160">        }</span>
    }

    @Nested
<span class="fc" id="L164">    class showAddConnectionFormTests {</span>

<span class="fc" id="L166">        String getMapping = &quot;/add_connection&quot;;</span>
<span class="fc" id="L167">        String viewName = &quot;add_connection_form&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void showAddConnectionFormTest() throws Exception {
<span class="fc" id="L172">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L173">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L174">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L175">        }</span>

        @Test
        public void showAddConnectionFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L179">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L180">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L181">        }</span>
    }

    @Nested
<span class="fc" id="L185">    class processAddConnectionTests {</span>

<span class="fc" id="L187">        String getMapping = &quot;/process_add_connection&quot;;</span>
<span class="fc" id="L188">        String viewName = &quot;contact&quot;;</span>

<span class="fc" id="L190">        String form = &quot;username=user02&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddConnectionTest() throws Exception {
<span class="fc" id="L195">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L196">                            .content(form))</span>
<span class="fc" id="L197">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L198">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L199">        }</span>

        @Test
        public void processAddConnectionTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L203">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L204">                            .content(form))</span>
<span class="fc" id="L205">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L206">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddConnectionTestIfEmpty() throws Exception {
<span class="pc" id="L211">            mockMvc.perform(post(getMapping)</span>
<span class="fc" id="L212">                            .with(csrf())</span>
<span class="fc" id="L213">                            .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L214">                            .content(&quot;username=&quot;))</span>
<span class="nc" id="L215">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L216">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddConnectionTestIfNull() throws Exception {
<span class="nc" id="L221">            mockMvc.perform(post(getMapping).with(csrf()))</span>
<span class="nc" id="L222">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L223">        }</span>
    }

    @Nested
<span class="fc" id="L227">    class showTransferFormTests {</span>

<span class="fc" id="L229">        String getMapping = &quot;/transfer&quot;;</span>
<span class="fc" id="L230">        String viewName = &quot;transfer&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void showTransferFormTest() throws Exception {
<span class="fc" id="L235">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L236">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L237">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L238">        }</span>

        @Test
        public void showTransferFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L242">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L243">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L244">        }</span>
    }

    @Nested
<span class="fc" id="L248">    class processTransferTests {</span>

<span class="fc" id="L250">        String getMapping = &quot;/process_transfer&quot;;</span>
<span class="fc" id="L251">        String viewName = &quot;transfer&quot;;</span>

<span class="fc" id="L253">        String form = &quot;amount=10&amp;receiverId=16&amp;description=description&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processTransferTest() throws Exception {
<span class="fc" id="L258">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L259">                            .content(form))</span>
<span class="fc" id="L260">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L261">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L262">        }</span>

        @Test
        public void processTransferTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L266">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L267">                            .content(form))</span>
<span class="fc" id="L268">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L269">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processTransferTestIfEmpty() throws Exception {
<span class="pc" id="L274">            mockMvc.perform(post(getMapping)</span>
<span class="fc" id="L275">                            .with(csrf())</span>
<span class="fc" id="L276">                            .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L277">                            .content(&quot;amount=&amp;receiverId=&amp;description=&quot;))</span>
<span class="nc" id="L278">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L279">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processTransferTestIfNull() throws Exception {
<span class="nc" id="L284">            mockMvc.perform(post(getMapping).with(csrf()))</span>
<span class="nc" id="L285">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L286">        }</span>
    }

    @Nested
<span class="fc" id="L290">    class showAddTransactionFromBankAccountFormTests {</span>

<span class="fc" id="L292">        String getMapping = &quot;/add_transaction_from_bank_account&quot;;</span>
<span class="fc" id="L293">        String viewName = &quot;add_transaction_from_bank_account&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void showAddTransactionFromBankAccountFormTest() throws Exception {
<span class="fc" id="L298">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L299">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L300">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L301">        }</span>

        @Test
        public void showAddTransactionFromBankAccountFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L305">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L306">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L307">        }</span>
    }

    @Nested
<span class="fc" id="L311">    class processAddTransactionFromBankAccountFormTests {</span>

<span class="fc" id="L313">        String getMapping = &quot;/process_add_transaction_from_bank_account&quot;;</span>
<span class="fc" id="L314">        String viewName = &quot;profile&quot;;</span>

<span class="fc" id="L316">        String form = &quot;amount=10&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionFromBankAccountFormTest() throws Exception {
<span class="fc" id="L321">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L322">                            .content(form))</span>
<span class="fc" id="L323">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L324">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L325">        }</span>

        @Test
        public void processAddTransactionFromBankAccountFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L329">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L330">                            .content(form))</span>
<span class="fc" id="L331">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L332">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionFromBankAccountFormTestIfEmpty() throws Exception {
<span class="pc" id="L337">            mockMvc.perform(post(getMapping)</span>
<span class="fc" id="L338">                            .with(csrf())</span>
<span class="fc" id="L339">                            .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L340">                            .content(&quot;amount=&quot;))</span>
<span class="nc" id="L341">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L342">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionFromBankAccountFormTestIfNull() throws Exception {
<span class="nc" id="L347">            mockMvc.perform(post(getMapping).with(csrf()))</span>
<span class="nc" id="L348">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L349">        }</span>
    }

    @Nested
<span class="fc" id="L353">    class showAddTransactionToBankAccountFormTests {</span>

<span class="fc" id="L355">        String getMapping = &quot;/add_transaction_to_bank_account&quot;;</span>
<span class="fc" id="L356">        String viewName = &quot;add_transaction_to_bank_account&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void showAddTransactionToBankAccountFormTest() throws Exception {
<span class="fc" id="L361">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L362">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L363">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L364">        }</span>

        @Test
        public void showAddTransactionToBankAccountFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L368">            mockMvc.perform(get(getMapping).with(csrf()))</span>
<span class="fc" id="L369">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L370">        }</span>
    }

    @Nested
<span class="fc" id="L374">    class processAddTransactionToBankAccountFormTests {</span>

<span class="fc" id="L376">        String getMapping = &quot;/process_add_transaction_to_bank_account&quot;;</span>
<span class="fc" id="L377">        String viewName = &quot;profile&quot;;</span>

<span class="fc" id="L379">        String form = &quot;amount=10&quot;;</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionToBankAccountFormTest() throws Exception {
<span class="fc" id="L384">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L385">                            .content(form))</span>
<span class="fc" id="L386">                    .andExpect(status().is2xxSuccessful())</span>
<span class="fc" id="L387">                    .andExpect(view().name(viewName));</span>
<span class="fc" id="L388">        }</span>

        @Test
        public void processAddTransactionToBankAccountFormTestIfNotAuthenticated() throws Exception {
<span class="fc" id="L392">            mockMvc.perform(post(getMapping).with(csrf()).contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L393">                            .content(form))</span>
<span class="fc" id="L394">                    .andExpect(status().is3xxRedirection());</span>
<span class="fc" id="L395">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionToBankAccountFormTestIfEmpty() throws Exception {
<span class="pc" id="L400">            mockMvc.perform(post(getMapping)</span>
<span class="fc" id="L401">                            .with(csrf())</span>
<span class="fc" id="L402">                            .contentType(MediaType.APPLICATION_FORM_URLENCODED)</span>
<span class="fc" id="L403">                            .content(&quot;amount=&quot;))</span>
<span class="nc" id="L404">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L405">        }</span>

        @WithMockUser(&quot;user01&quot;)
        @Test
        public void processAddTransactionToBankAccountFormTestIfNull() throws Exception {
<span class="nc" id="L410">            mockMvc.perform(post(getMapping).with(csrf()))</span>
<span class="nc" id="L411">                    .andExpect(status().is4xxClientError());</span>
<span class="nc" id="L412">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>